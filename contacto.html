<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Portal de Becas UTN - Contacto</title>

    <link rel="stylesheet" href="css/tailwind.css" />
    <link rel="stylesheet" href="css/custom.css" />
    <link rel="stylesheet" href="css/contacto.css" />

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

    <!-- Google reCAPTCHA -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>

<body>
    <!-- NAVBAR -->
    <header class="site-header">
        <nav class="utn-navbar">
            <div class="container nav-inner">
                <a href="index.html" class="nav-brand">
                    <img src="img/logo2.webp" alt="Logo UTN" class="logo-utn">
                    <span>Portal de Becas UTN</span>
                </a>

                <ul class="nav-links">
                    <li><a href="index.html" class="nav-link">Inicio</a></li>
                    <li><a href="acerca.html" class="nav-link">Acerca</a></li>
                    <li><a href="contacto.html" class="nav-link nav-link--active">Contacto</a></li>
                    <li><a href="propuesta.html" class="nav-link">Propuesta</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main class="section bg-slate-50">
        <div class="container space-y-12">
            <section class="text-center py-8">
                <h1 class="text-3xl font-bold text-[var(--utn-azul-oscuro)]">Contacto</h1>
                <p class="text-slate-600 max-w-xl mx-auto mt-2">
                    Envía tus consultas o comentarios acerca del Portal de la administración de Becas de la UTN.
                </p>
            </section>

            <!-- GRID -->
            <div class="grid gap-10 grid-cols-1 md:grid-cols-2">

                <!-- FORMULARIO -->
                <div class="form-card">

                    <h2 class="text-xl font-semibold text-[var(--utn-azul-oscuro)]">Formulario de contacto</h2>
                    <form id="contactForm"
                        action="https://formspree.io/f/xblnkrzz"
                        method="POST"
                        class="space-y-4">

                        <input type="hidden" name="_subject" value="Nuevo mensaje desde el Portal UTN">

                        <div>
                            <label for="nombre" class="font-semibold text-sm">Nombre:</label>
                            <input id="nombre" name="name" type="text" class="w-full border rounded-lg p-2 text-sm"
                                placeholder="Tu nombre" required>
                        </div>

                        <div>
                            <label for="correo" class="font-semibold text-sm">Correo electrónico:</label>
                            <input id="correo" name="email" type="email" class="w-full border rounded-lg p-2 text-sm"
                                placeholder="correo@ejemplo.com" required>
                        </div>

                        <div>
                            <label for="asunto" class="font-semibold text-sm">Asunto:</label>
                            <input id="asunto" name="subject" type="text" class="w-full border rounded-lg p-2 text-sm"
                                placeholder="Motivo del mensaje" required>
                        </div>

                        <div>
                            <label for="mensaje" class="font-semibold text-sm">Mensaje:</label>
                            <textarea id="mensaje" name="message" rows="4"
                                class="w-full border rounded-lg p-2 text-sm"
                                placeholder="Escribe tu mensaje aquí..." required></textarea>
                        </div>

                        <!-- Google RECAPTCHA -->
                        <div class="g-recaptcha" data-sitekey="6Le4iiAsAAAAAPYgsv46UvhKq_5ykwYn_o8N4iD5"></div>

                        <button id="submitBtn" type="submit"
                                class="btn-utn-primary w-full text-center font-semibold">
                            Enviar mensaje
                        </button>

                        <p id="confirmMessage" class="hidden text-green-600 font-semibold text-sm mb-3">
                            ¡Tu mensaje se envió correctamente!
                        </p>

                    </form>
                </div>

                <!-- Información -->
                <div class="space-y-6">
                    <div class="bg-white shadow-md rounded-2xl p-6">
                        <h2 class="text-xl font-semibold text-[var(--utn-azul-oscuro)] mb-2">Información</h2>
                        <p><strong>Correo:</strong> soporte@utn.ac.cr</p>
                        <p><strong>Teléfono:</strong> 2450-0000</p>
                        <p><strong>Oficinas:</strong> UTN - Sede Central Alajuela</p>
                    </div>

                    <!-- Mapa Interactivo -->
                    <div id="hs-grayscale-leaflet" class="h-[300px] rounded-2xl border hs-leaflet z-10"></div>
                </div>

            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="container footer-inner">
            Portal de Becas UTN · ISW-512 Diseño de Aplicaciones Web · 2025
        </div>
    </footer>


    <!-- VALIDACIÓN Y ENVÍO -->
    <script>
document.getElementById("contactForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const submitBtn = document.getElementById("submitBtn");
    const confirmMessage = document.getElementById("confirmMessage");
    const modalContent = document.getElementById("modalContent");

    // obtener token de reCAPTCHA
    const token = grecaptcha.getResponse();
    if (!token) {
        alert("Por favor completa el reCAPTCHA.");
        return;
    }

    submitBtn.textContent = "Enviando...";
    submitBtn.disabled = true;

    const formData = new FormData();
    formData.append("name", document.getElementById("nombre").value);
    formData.append("email", document.getElementById("correo").value);
    formData.append("subject", document.getElementById("asunto").value);
    formData.append("message", document.getElementById("mensaje").value);

    // Formspree recaptcha field
    formData.append("g-recaptcha-response", token);

    try {
        const res = await fetch("https://formspree.io/f/xblnkrzz", {
            method: "POST",
            headers: { "Accept": "application/json" },
            body: formData
        });

        const data = await res.json();
        console.log("Formspree response:", data);

        if (res.ok && data.ok) {

            modalContent.innerHTML = `
                <p><strong>Nombre:</strong> ${formData.get("name")}</p>
                <p><strong>Correo:</strong> ${formData.get("email")}</p>
                <p><strong>Asunto:</strong> ${formData.get("subject")}</p>
                <p><strong>Mensaje:</strong> ${formData.get("message")}</p>
            `;

            document.getElementById("my_modal_1").showModal();

            confirmMessage.classList.remove("hidden");
            setTimeout(() => confirmMessage.classList.add("hidden"), 3000);

            document.getElementById("contactForm").reset();
            grecaptcha.reset();

        } else {
            alert("Error: " + (data.error ?? "Error al enviar el formulario"));
            console.error("Formspree error:", data);
        }

    } catch (err) {
        alert("Error de conexión.");
        console.error(err);
    }

    submitBtn.textContent = "Enviar mensaje";
    submitBtn.disabled = false;
});
</script>

    <!-- Script Mapa -->
    <script>
        window.addEventListener('load', () => {
            const map = L.map('hs-grayscale-leaflet', {
                center: [10.00710650559122, -84.21645643816866],
                zoom: 17,
                maxBounds: [
                    [9, -85],
                    [11, -83]
                ],
                maxBoundsViscosity: 1.0
            });

            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                maxZoom: 19,
                minZoom: 2,
                attribution: '© CARTO'
            }).addTo(map);

            L.marker([10.00710650559122, -84.21645643816866])
                .bindPopup('Universidad Técnica Nacional - Sede Central<br>Acequia Grande, Alajuela')
                .addTo(map);
        });
    </script>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>


    <!-- NUEVO MODAL (DaisyUI) -->
    <dialog id="my_modal_1" class="modal">
      <div class="modal-box">
        <h3 class="text-lg font-bold mb-4">Datos enviados</h3>

        <div id="modalContent" class="space-y-2 mb-4"></div>

        <div class="modal-action">
          <form method="dialog">
            <button class="btn btn-primary">Cerrar</button>
          </form>
        </div>
      </div>
    </dialog>

</body>
</html>
